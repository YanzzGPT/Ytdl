<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Downloader Ultra - Working Download</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF0000;
            --primary-dark: #CC0000;
            --primary-light: #FF4444;
            --secondary: #282828;
            --bg-dark: #0a0a0a;
            --bg-card: #1a1a1a;
            --bg-card-hover: #252525;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent: #4CAF50;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --shadow-glow: 0 0 40px rgba(255, 0, 0, 0.3);
            --success: #4CAF50;
            --warning: #FF9800;
            --error: #F44336;
            --info: #2196F3;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            position: relative;
        }

        /* Background Animation */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            background: radial-gradient(ellipse at center, #1a1a1a 0%, #0a0a0a 100%);
        }

        .bg-animation::before,
        .bg-animation::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.3;
        }

        .bg-animation::before {
            width: 600px;
            height: 600px;
            background: var(--primary);
            top: -200px;
            right: -200px;
            animation: float1 20s ease-in-out infinite;
        }

        .bg-animation::after {
            width: 800px;
            height: 800px;
            background: var(--gradient-1);
            bottom: -300px;
            left: -300px;
            animation: float2 25s ease-in-out infinite;
        }

        @keyframes float1 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }

        @keyframes float2 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-30px, 30px) rotate(180deg); }
        }

        /* Header */
        header {
            padding: 2rem;
            text-align: center;
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideDown 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient-1);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: logoGlow 3s ease-in-out infinite;
            box-shadow: var(--shadow-glow);
        }

        @keyframes logoGlow {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            }
            50% { 
                transform: scale(1.05) rotate(5deg);
                box-shadow: 0 0 40px rgba(255, 0, 0, 0.8);
            }
        }

        .logo-icon svg {
            width: 35px;
            height: 35px;
            fill: white;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--error);
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: var(--success);
        }

        .status-dot.connecting {
            background: var(--warning);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 3rem 1rem;
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
            animation: fadeInScale 0.8s ease-out 0.3s both;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Debug Panel */
        .debug-panel {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid var(--info);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            font-size: 0.85rem;
            color: var(--info);
        }

        .debug-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .debug-item {
            display: flex;
            justify-content: space-between;
        }

        /* URL Input Section */
        .url-section {
            background: linear-gradient(145deg, var(--bg-card), var(--bg-card-hover));
            border-radius: 24px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .url-section:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 30px 80px rgba(255, 0, 0, 0.3);
        }

        .input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .url-input {
            flex: 1;
            padding: 1.2rem 1.8rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            color: var(--text-primary);
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .url-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.4);
            transform: scale(1.02);
        }

        .url-input::placeholder {
            color: var(--text-secondary);
        }

        .fetch-btn {
            padding: 1.2rem 2.5rem;
            background: var(--gradient-2);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .fetch-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(245, 87, 108, 0.4);
        }

        .fetch-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Loading State */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            margin: 0 auto 1rem;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Video Preview */
        .video-preview {
            display: none;
            background: linear-gradient(145deg, var(--bg-card), var(--bg-card-hover));
            border-radius: 24px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUpBounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes slideUpBounce {
            0% {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            60% {
                opacity: 1;
                transform: translateY(-10px) scale(1.02);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .video-preview.active {
            display: block;
        }

        .preview-header {
            display: flex;
            gap: 2rem;
            margin-bottom: 2.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .thumbnail {
            width: 240px;
            height: 135px;
            background: var(--gradient-3);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            animation: thumbnailFloat 4s ease-in-out infinite;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.3);
            position: relative;
            overflow: hidden;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 16px;
        }

        @keyframes thumbnailFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(1deg); }
            75% { transform: translateY(5px) rotate(-1deg); }
        }

        .video-info {
            flex: 1;
            min-width: 250px;
        }

        .video-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .video-meta {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.8;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        /* Format Selection */
        .format-selection {
            margin-bottom: 2rem;
        }

        .format-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
            color: var(--text-primary);
        }

        .format-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .format-card {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
        }

        .format-card:hover {
            transform: translateY(-10px) scale(1.05);
            border-color: var(--primary);
            background: rgba(255, 0, 0, 0.1);
            box-shadow: 0 20px 40px rgba(255, 0, 0, 0.3);
        }

        .format-card.selected {
            background: linear-gradient(145deg, rgba(255, 0, 0, 0.2), rgba(255, 0, 0, 0.1));
            border-color: var(--primary);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
        }

        .format-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .format-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .format-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Quality Selection */
        .quality-section {
            display: none;
            animation: fadeInSlide 0.5s ease-out;
        }

        .quality-section.active {
            display: block;
        }

        @keyframes fadeInSlide {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .quality-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .quality-btn {
            padding: 1.2rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
        }

        .quality-btn:hover {
            background: rgba(255, 0, 0, 0.1);
            border-color: var(--primary);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 0, 0, 0.3);
        }

        .quality-btn.selected {
            background: linear-gradient(145deg, rgba(255, 0, 0, 0.3), rgba(255, 0, 0, 0.2));
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
        }

        .quality-label {
            display: block;
            margin-bottom: 0.3rem;
        }

        .quality-spec {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Download Section */
        .download-section {
            text-align: center;
            padding: 2.5rem;
            background: linear-gradient(145deg, var(--bg-card), var(--bg-card-hover));
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .download-section.active {
            display: block;
            animation: fadeInScale 0.5s ease-out;
        }

        .download-btn {
            padding: 1.5rem 4rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 10px 30px rgba(255, 0, 0, 0.3);
        }

        .download-btn:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 40px rgba(255, 0, 0, 0.5);
        }

        .download-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Progress Bar */
        .progress-container {
            display: none;
            margin-top: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .progress-text {
            margin-top: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(145deg, var(--bg-card), var(--bg-card-hover));
            border: 2px solid var(--primary);
            border-radius: 16px;
            padding: 1.2rem 1.8rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(500px);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(255, 0, 0, 0.3);
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-color: var(--success);
        }

        .toast.error {
            border-color: var(--error);
        }

        .toast.warning {
            border-color: var(--warning);
        }

        .toast.info {
            border-color: var(--info);
        }

        .toast-icon {
            width: 35px;
            height: 35px;
            background: var(--gradient-2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .toast-message {
            font-weight: 600;
            word-wrap: break-word;
        }

        /* Footer */
        footer {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(20px);
            padding: 2.5rem;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: auto;
        }

        .footer-content {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .footer-content a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .footer-content a:hover {
            color: var(--primary-light);
        }

        /* Disclaimer */
        .disclaimer {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid var(--warning);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            font-size: 0.9rem;
            color: var(--warning);
            text-align: center;
        }

        /* Sample URLs */
        .sample-urls {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
        }

        .sample-urls h4 {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .sample-url-btn {
            display: inline-block;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .sample-url-btn:hover {
            background: rgba(255, 0, 0, 0.1);
            border-color: var(--primary);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .logo {
                font-size: 2rem;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .preview-header {
                flex-direction: column;
                text-align: center;
            }
            
            .thumbnail {
                width: 100%;
                max-width: 300px;
            }
            
            .format-options {
                grid-template-columns: 1fr;
            }
            
            .quality-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .toast {
                right: 1rem;
                left: 1rem;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <header>
        <div class="logo">
            <div class="logo-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
                </svg>
            </div>
            YouTube Downloader Ultra
        </div>
        <p class="subtitle">‚ú® Working Download with yt-dlp Integration</p>
        <div class="status-indicator">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Checking API...</span>
        </div>
    </header>

    <main>
        <div class="debug-panel" id="debugPanel">
            <strong>üîç Debug Information:</strong>
            <div class="debug-info">
                <div class="debug-item">
                    <span>API Base:</span>
                    <span id="debugApiBase">-</span>
                </div>
                <div class="debug-item">
                    <span>Server Status:</span>
                    <span id="debugServerStatus">-</span>
                </div>
                <div class="debug-item">
                    <span>yt-dlp:</span>
                    <span id="debugYtDlp">Checking...</span>
                </div>
                <div class="debug-item">
                    <span>Method:</span>
                    <span id="debugMethod">-</span>
                </div>
            </div>
        </div>

        <div class="disclaimer">
            ‚ö†Ô∏è <strong>LEGAL DISCLAIMER:</strong> Use only for content you have rights to download. This tool is for educational purposes only.
        </div>

        <div class="sample-urls">
            <h4>üì∫ Try these sample URLs:</h4>
            <button class="sample-url-btn" onclick="loadSampleUrl('https://www.youtube.com/watch?v=jNQXAC9IVRw')">
                "Me at the zoo" - First YouTube video
            </button>
            <button class="sample-url-btn" onclick="loadSampleUrl('https://www.youtube.com/watch?v=9bZkp7q19f0')">
                Sample Music Video
            </button>
        </div>

        <section class="url-section">
            <div class="input-group">
                <input type="text" class="url-input" id="urlInput" placeholder="üîó Paste YouTube URL here...">
                <button class="fetch-btn" id="fetchBtn" onclick="fetchVideo()">Fetch Info</button>
            </div>
        </section>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">Fetching video information...</p>
        </div>

        <section class="video-preview" id="videoPreview">
            <div class="preview-header">
                <div class="thumbnail" id="thumbnailContainer">
                    <div>‚ñ∂</div>
                </div>
                <div class="video-info">
                    <div class="video-title" id="videoTitle">Loading...</div>
                    <div class="video-meta">
                        <div>üëÅ <span id="videoViews">0</span> views</div>
                        <div>üìÖ <span id="videoDate">Unknown</span></div>
                        <div>üë§ <span id="videoChannel">Unknown</span></div>
                        <div>‚è± <span id="videoDuration">0:00</span></div>
                    </div>
                </div>
            </div>

            <div class="format-selection">
                <h3 class="format-title">üéØ Choose Download Format</h3>
                <div class="format-options">
                    <div class="format-card" onclick="selectFormat('video', this)">
                        <div class="format-icon">üé¨</div>
                        <div class="format-name">Video</div>
                        <div class="format-desc">Download with visual content</div>
                    </div>
                    <div class="format-card" onclick="selectFormat('audio', this)">
                        <div class="format-icon">üéµ</div>
                        <div class="format-name">Audio</div>
                        <div class="format-desc">Extract audio only</div>
                    </div>
                </div>
            </div>

            <div class="quality-section" id="videoQuality">
                <h3 class="format-title">üì∫ Select Video Quality</h3>
                <div class="quality-grid" id="videoQualityGrid">
                    <!-- Will be populated dynamically -->
                </div>
            </div>

            <div class="quality-section" id="audioQuality">
                <h3 class="format-title">üéß Select Audio Quality</h3>
                <div class="quality-grid" id="audioQualityGrid">
                    <!-- Will be populated dynamically -->
                </div>
            </div>

            <div class="download-section" id="downloadSection">
                <button class="download-btn" id="downloadBtn" onclick="startDownload()">
                    üöÄ Start Download
                </button>
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar" id="progressBar"></div>
                    <div class="progress-text" id="progressText">Preparing download...</div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p>¬© 2024 YouTube Downloader Ultra. All rights reserved.</p>
            <p>Crafted with üíú and passion by <a href="#">Syawaliuz Octavian</a></p>
            <p><small>For educational and testing purposes only</small></p>
        </div>
    </footer>

    <div class="toast" id="toast">
        <div class="toast-icon" id="toastIcon">‚Ñπ</div>
        <div class="toast-message" id="toastMessage">Notification</div>
    </div>

    <script>
        // Configuration
        const API_BASE = '/api'; // Disederhanakan untuk Vercel
        let currentVideoInfo = null;
        let selectedFormat = null;
        let selectedQuality = null;

        // Update debug info
        function updateDebugInfo(key, value) {
            const element = document.getElementById('debug' + key);
            if (element) {
                element.textContent = value;
            }
        }

        // Update status indicator
        function updateStatus(status, text) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            statusDot.className = 'status-dot ' + status;
            statusText.textContent = text;
            
            updateDebugInfo('ServerStatus', text);
        }

        // Check API connectivity
        async function checkAPIConnectivity() {
            updateStatus('connecting', 'Checking API...');
            
            try {
                const response = await fetch(API_BASE + '/test');
                const data = await response.json();
                
                if (response.ok) {
                    updateDebugInfo('ApiBase', window.location.origin + API_BASE);
                    updateStatus('connected', 'API Connected');
                    showToast('‚úÖ API connected successfully', 'success');
                    return true;
                }
            } catch (error) {
                console.log('Failed to connect to API:', error.message);
            }
            
            updateStatus('', 'API Disconnected');
            showToast('‚ùå Failed to connect to API server', 'error');
            return false;
        }

        // Load sample URL
        function loadSampleUrl(url) {
            document.getElementById('urlInput').value = url;
            fetchVideo();
        }

        // Fetch video info from backend
        async function fetchVideo() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            
            if (!url) {
                showToast('‚ö†Ô∏è Please enter a YouTube URL', 'error');
                urlInput.focus();
                return;
            }

            const fetchBtn = document.getElementById('fetchBtn');
            const loading = document.getElementById('loading');
            const videoPreview = document.getElementById('videoPreview');
            
            videoPreview.classList.remove('active');
            fetchBtn.disabled = true;
            fetchBtn.textContent = 'Fetching...';
            loading.classList.add('active');
            
            try {
                const response = await fetch(`${API_BASE}/video-info`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.details || data.error || 'Failed to fetch video info');
                }
                
                currentVideoInfo = data;
                updateDebugInfo('Method', data.method || 'Unknown');
                updateVideoInfo(data);
                populateQualityOptions(data.formats);
                
                loading.classList.remove('active');
                videoPreview.classList.add('active');
                
                if (data.downloadAvailable) {
                    showToast('‚úÖ Video info loaded!', 'success');
                } else {
                    showToast('‚ÑπÔ∏è Info loaded, but no download options found.', 'warning');
                }
                
                videoPreview.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
            } catch (error) {
                console.error('Error fetching video:', error);
                showToast(`‚ùå Error: ${error.message}`, 'error');
                loading.classList.remove('active');
            } finally {
                fetchBtn.disabled = false;
                fetchBtn.textContent = 'Fetch Info';
            }
        }

        // Update video info in UI
        function updateVideoInfo(info) {
            document.getElementById('videoTitle').textContent = info.title || 'Unknown Title';
            document.getElementById('videoViews').textContent = info.views || '0';
            document.getElementById('videoDate').textContent = info.uploadDate || 'Unknown';
            document.getElementById('videoChannel').textContent = info.channel || 'Unknown';
            document.getElementById('videoDuration').textContent = info.duration || '0:00';
            
            const thumbnailContainer = document.getElementById('thumbnailContainer');
            if (info.thumbnail) {
                thumbnailContainer.innerHTML = `<img src="${info.thumbnail}" alt="Video thumbnail" onerror="this.parentElement.innerHTML='‚ñ∂'">`;
            }
        }

        // Populate quality options
        function populateQualityOptions(formats) {
            const videoGrid = document.getElementById('videoQualityGrid');
            const audioGrid = document.getElementById('audioQualityGrid');
            
            videoGrid.innerHTML = '';
            audioGrid.innerHTML = '';
            
            if (formats.video && formats.video.length > 0) {
                formats.video.forEach((format) => {
                    const button = document.createElement('button');
                    button.className = 'quality-btn';
                    button.onclick = () => selectQuality(button, 'video', format.quality);
                    button.innerHTML = `<span class="quality-label">${format.quality}</span><span class="quality-spec">${format.fps}fps ‚Ä¢ ${format.format} ‚Ä¢ ${format.size}</span>`;
                    videoGrid.appendChild(button);
                });
            } else {
                videoGrid.innerHTML = '<p style="color: var(--text-secondary);">No video formats available</p>';
            }
            
            if (formats.audio && formats.audio.length > 0) {
                formats.audio.forEach((format) => {
                    const button = document.createElement('button');
                    button.className = 'quality-btn';
                    button.onclick = () => selectQuality(button, 'audio', format.quality);
                    button.innerHTML = `<span class="quality-label">${format.quality}</span><span class="quality-spec">${format.format} ‚Ä¢ ${format.size}</span>`;
                    audioGrid.appendChild(button);
                });
            } else {
                audioGrid.innerHTML = '<p style="color: var(--text-secondary);">No audio formats available</p>';
            }
        }

        // Select format
        function selectFormat(format, element) {
            document.querySelectorAll('.format-card').forEach(card => card.classList.remove('selected'));
            element.classList.add('selected');
            selectedFormat = format;
            selectedQuality = null;
            
            document.getElementById('videoQuality').classList.remove('active');
            document.getElementById('audioQuality').classList.remove('active');
            document.getElementById('downloadSection').classList.remove('active');
            
            setTimeout(() => {
                const qualitySectionId = format === 'video' ? 'videoQuality' : 'audioQuality';
                const qualityGrid = document.getElementById(qualitySectionId + 'Grid');
                document.getElementById(qualitySectionId).classList.add('active');
                const firstQualityBtn = qualityGrid.querySelector('.quality-btn');
                if (firstQualityBtn) firstQualityBtn.click();
                showToast(format === 'video' ? 'üé¨ Video format selected' : 'üéµ Audio format selected', 'info');
            }, 300);
        }

        // Select quality
        function selectQuality(button, type, quality) {
            const parent = button.parentElement;
            parent.querySelectorAll('.quality-btn').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedQuality = quality;
            showToast(type === 'video' ? `üì∫ Video quality: ${quality}` : `üéß Audio quality: ${quality}`, 'info');
            setTimeout(() => document.getElementById('downloadSection').classList.add('active'), 300);
        }

        // Start download (Vercel-friendly)
        function startDownload() {
            if (!selectedFormat || !selectedQuality) {
                showToast('‚ö†Ô∏è Please select format and quality first', 'error');
                return;
            }

            const downloadBtn = document.getElementById('downloadBtn');
            const url = document.getElementById('urlInput').value.trim();
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            downloadBtn.disabled = true;
            downloadBtn.innerHTML = 'üöÄ Starting...';
            progressContainer.classList.add('active');
            progressBar.style.width = '100%';
            progressText.textContent = 'Your download will begin shortly...';
            
            showToast('‚úÖ Preparing your download...', 'success');

            const downloadUrl = `${API_BASE}/download?url=${encodeURIComponent(url)}&format=${selectedFormat}&quality=${selectedQuality}`;
            
            // Menggunakan window.open untuk memulai unduhan
            window.open(downloadUrl, '_blank');
            
            setTimeout(() => {
                downloadBtn.disabled = false;
                downloadBtn.innerHTML = 'üöÄ Start Another Download';
                progressContainer.classList.remove('active');
            }, 5000);
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');
            
            toastMessage.textContent = message;
            
            const icons = { success: '‚úì', error: '‚úï', warning: '‚ö†', info: '‚Ñπ' };
            toastIcon.textContent = icons[type] || '‚Ñπ';
            toast.className = `toast ${type} show`;
            
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        document.getElementById('urlInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') fetchVideo();
        });

        window.addEventListener('load', () => {
            document.getElementById('urlInput').focus();
            checkAPIConnectivity();
        });
    </script>
</body>
</html>